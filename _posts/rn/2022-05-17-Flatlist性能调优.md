---
title:      Flatlistæ€§èƒ½è°ƒä¼˜
date:       2022-05-17
tags:       ["rn"]
category:   React Native
math:       true
---

## æœ¯è¯­å®šä¹‰

- **VirtualizedList:** `FlatList`èƒŒåçš„åŸºç¡€æ”¯æ’‘ç»„ä»¶ï¼ˆæ˜¯ React Native å¯¹[`è™šæ‹Ÿåˆ—è¡¨ Virtual List`](https://bvaughn.github.io/react-virtualized/#/components/List)æ¦‚å¿µçš„å®ç°ï¼‰ã€‚
- **å†…å­˜å¼€é”€ Memory consumption:** åˆ—è¡¨åœ¨å†…å­˜ä¸­å­˜æ”¾å¤šå°‘æ•°æ®ã€‚å¼€é”€è¿‡å¤§å¯èƒ½å¯¼è‡´åº”ç”¨å´©æºƒã€‚
- **å“åº”åº¦ Responsiveness:** åº”ç”¨å¯¹äºç”¨æˆ·æ“ä½œçš„å“åº”é€Ÿåº¦ã€‚æ¯”å¦‚ä½å“åº”åº¦å°±æ˜¯ä½ åœ¨æ“ä½œæ—¶ï¼Œåº”ç”¨è¦å¡ä¸€ä¼šå„¿æ‰å“åº”ã€‚
- **ç©ºç™½åŒº Blank areas:** å½“`VirtualizedList`æ¸²æŸ“çš„é€Ÿåº¦è·Ÿä¸ä¸Šä½ æ»‘åŠ¨çš„é€Ÿåº¦æ—¶ï¼Œä½ å¯èƒ½ä¼šåœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ä¸€äº›å°šæœªå®Œæˆæ¸²æŸ“çš„ç©ºç™½å ä½å…ƒç´ ã€‚
- **è§†å£ Viewport:** å·²æ¸²æŸ“å†…å®¹çš„å¯è§†åŒºåŸŸã€‚
- **æ»‘åŠ¨çª—å£ Window:** The area in which items should be mounted, which is generally much larger than the viewport.

## Props

### removeClippedSubviews

| ç±»å‹    | DEFAULT |
| :------ | :------ |
| Boolean | False   |

å¦‚æœä¸ºçœŸï¼Œåœ¨è§†å£ä¹‹å¤–çš„è§†å›¾å°†ä»æœ¬æœºè§†å›¾å±‚æ¬¡ç»“æ„ä¸­åˆ†ç¦»ã€‚

**å¥½å¤„ï¼š** å¯ç”¨æ­¤é€‰é¡¹å¯å‡å°‘èŠ±åœ¨ä¸»çº¿ç¨‹ä¸Šçš„æ—¶é—´ï¼Œä»è€Œé™ä½ä¸¢å¸§çš„é£é™©ã€‚åŸç†æ˜¯å¯¹è§†å£ä¹‹å¤–çš„è§†å›¾ä¸è¿›è¡Œæœ¬åœ°æ¸²æŸ“å’Œç»˜å›¾éå†ã€‚

**åå¤„ï¼š** è¯·æ³¨æ„ï¼Œè¿™ç§å®ç°å¯èƒ½ä¼šæœ‰ bugï¼Œæ¯”å¦‚ä¸¢å¤±å†…å®¹ï¼ˆä¸»è¦æ˜¯åœ¨ iOS ä¸Šè§‚å¯Ÿåˆ°çš„ï¼‰ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä½¿ç”¨å˜æ¢å’Œ/æˆ–ç»å¯¹å®šä½åšå¤æ‚çš„äº‹æƒ…æ—¶ã€‚å¦å¤–ï¼Œè¯·æ³¨æ„è¿™å¹¶ä¸ä¼šèŠ‚çœå¤§é‡çš„å†…å­˜ï¼Œå› ä¸ºè§†å›¾å¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œåªæ˜¯è¢«åˆ†ç¦»äº†ã€‚

**å®è·µï¼šå˜åŒ–ä¸å¤§**

**æ¨èæŒ‡æ•°ï¼š** â­ï¸

### maxToRenderPerBatch

| ç±»å‹   | DEFAULT |
| :----- | :------ |
| Number | 10      |

å®ƒæ˜¯ä¸€ä¸ªVirtualizedListé“å…·ï¼Œå¯ä»¥é€šè¿‡FlatListä¼ é€’ã€‚è¿™æ§åˆ¶äº†æ¯æ‰¹æ¸²æŸ“çš„é¡¹ç›®æ•°é‡ï¼Œè¿™æ˜¯æ¯ä¸ªå·è½´ä¸Šæ¸²æŸ“çš„ä¸‹ä¸€ä¸ªé¡¹ç›®å—ã€‚

**å¥½å¤„ï¼š** è®¾ç½®æ›´å¤§çš„æ•°å­—æ„å‘³ç€æ»šåŠ¨æ—¶è§†è§‰ç©ºç™½åŒºåŸŸæ›´å°‘(å¢åŠ å¡«å……ç‡)ã€‚

**åå¤„ï¼š**æ¯æ‰¹å¤„ç†çš„é¡¹ç›®è¶Šå¤šï¼Œæ„å‘³ç€JavaScriptæ‰§è¡Œçš„æ—¶é—´è¶Šé•¿ï¼Œå¯èƒ½ä¼šé˜»å¡å…¶ä»–äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚æŒ‰ä¸‹æŒ‰é’®ï¼Œå½±å“å“åº”ã€‚

**å®è·µï¼šè¿™æ˜¯ä¸€ä¸ªå–èˆé—®é¢˜ï¼Œå–å†³äºä½ æƒ³æ¯æ¬¡æ¸²æŸ“æ›´å¤šçš„è§†å›¾è¿˜æ˜¯è·å¾—æ›´å¥½çš„ä½“éªŒ**

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸

### updateCellsBatchingPeriod

| ç±»å‹   | DEFAULT |
| :----- | :------ |
| Number | 50      |

`maxToRenderPerBatch`å‘Šè¯‰æ¯ä¸ªæ‰¹å¤„ç†æ¸²æŸ“çš„é¡¹ç›®æ•°é‡ï¼Œè®¾ç½®`updateCellsBatchingPeriod`å‘Šè¯‰`VirtualizedList`æ‰¹å¤„ç†æ¸²æŸ“ä¹‹é—´çš„å»¶è¿Ÿ(ä»¥æ¯«ç§’ä¸ºå•ä½)(ä½ çš„ç»„ä»¶æ¸²æŸ“çª—å£é¡¹ç›®çš„é¢‘ç‡)ã€‚

**å¥½å¤„ï¼š**ç»“åˆè¿™ä¸ªé“å…·maxToRenderPerBatchç»™ä½ çš„æƒåŠ›ã€‚ä¾‹å¦‚ï¼Œå°‘æ‰¹é‡å‘ˆç°æ›´å¤šçš„æ¡ç›®,æˆ–å°‘ç‰©å“æ›´é¢‘ç¹çš„æ‰¹å¤„ç†ã€‚

**åå¤„ï¼š**å°‘æ‰¹æ¬¡å¯èƒ½ä¼šå¼•èµ·ç©ºç™½åŒºåŸŸ,æ›´é¢‘ç¹çš„æ‰¹æ¬¡å¯èƒ½ä¼šå¯¼è‡´å“åº”é—®é¢˜ã€‚

**å®è·µï¼šåŒä¸Š**

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸

### initialNumToRender

| ç±»å‹   | DEFAULT |
| :----- | :------ |
| Number | 10      |

è¦æ¸²æŸ“çš„é¡¹ç›®çš„åˆå§‹æ•°é‡ã€‚

**å¥½å¤„ï¼š** ä¸ºæ¯ä¸ªè®¾å¤‡å®šä¹‰ç²¾ç¡®çš„ï¼ˆåˆšå¥½å¯ä»¥ï¼‰è¦†ç›–å±å¹•çš„é¡¹ç›®æ•°é‡ã€‚è¿™å¯ä»¥å¤§å¤§æå‡åˆå§‹æ¸²æŸ“çš„æ€§èƒ½ã€‚

**åå¤„ï¼š**è®¾ç½®ä¸€ä¸ªå°çš„ `initialNumToRender` å¯èƒ½å¯¼è‡´ç©ºç™½åŒºåŸŸï¼Œå°¤å…¶æ˜¯åœ¨åˆå§‹åŒ–æ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœè®¾ç½®å¾—å¤ªå°ä»¥è‡³äºä¸èƒ½è¦†ç›–æ•´ä¸ªè§†å£ã€‚



### windowSize

| ç±»å‹   | DEFAULT |
| :----- | :------ |
| Number | 21      |

æ­¤å¤„ä¼ é€’çš„æ•°å­—æ˜¯ä¸€ä¸ªæµ‹é‡å•ä½ï¼Œå…¶ä¸­ 1 ç­‰äºæ‚¨çš„è§†å£é«˜åº¦ã€‚ é»˜è®¤å€¼ä¸º 21ï¼ˆä¸Šæ–¹ 10 ä¸ªè§†å£ï¼Œä¸‹æ–¹ 10 ä¸ªè§†å£ï¼Œä»‹äºä¸¤è€…ä¹‹é—´ï¼‰ã€‚

**å¥½å¤„ï¼š**æ›´å¤§çš„`çª—å£å¤§å°`å°†å¯¼è‡´æ»šåŠ¨æ—¶çœ‹åˆ°ç©ºç™½ç©ºé—´çš„æœºä¼šæ›´å°‘ã€‚ å¦ä¸€æ–¹é¢ï¼Œè¾ƒå°çš„`çª—å£å¤§å°`å°†å¯¼è‡´åŒæ—¶å®‰è£…çš„é¡¹ç›®æ›´å°‘ï¼Œä»è€ŒèŠ‚çœå†…å­˜ã€‚

**åå¤„ï¼š** å¯¹äºæ›´å¤§çš„`çª—å£å¤§å°`ï¼Œæ‚¨å°†æœ‰æ›´å¤šçš„å†…å­˜æ¶ˆè€—ã€‚ å¯¹äºè¾ƒä½çš„`çª—å£å¤§å°`ï¼Œæ‚¨å°†æœ‰æ›´å¤§çš„æœºä¼šçœ‹åˆ°ç©ºç™½åŒºåŸŸã€‚

## List items

### ä½¿ç”¨ç®€å•ç»„ä»¶

ç»„ä»¶è¶Šå¤æ‚ä¸€èˆ¬æ¸²æŸ“å°±è¶Šæ…¢ã€‚å°½é‡é¿å…åœ¨ä½ çš„åˆ—è¡¨é¡¹ä¸­æœ‰å¾ˆå¤šé€»è¾‘å’ŒåµŒå¥—ã€‚å¦‚æœä½ åœ¨ä½ çš„åº”ç”¨ä¸­ç»å¸¸é‡ç”¨è¿™ä¸ªåˆ—è¡¨é¡¹ç»„ä»¶ï¼Œä¸ºä½ çš„å¤§åˆ—è¡¨åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œè®©å®ƒä»¬å°½å¯èƒ½å°‘çš„é€»è¾‘å’ŒåµŒå¥—ã€‚

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸ â­ï¸ â­ï¸ ï¼ˆè¿™ä¸ªæ²¡æ³•å’Œäº§å“è®¾è®¡äº‰ï¼‰

### ä½¿ç”¨è½»é‡ç»„ä»¶

ç»„ä»¶å¤ªé‡è‡ªç„¶ä¹Ÿä¼šæ‹–æ…¢æ¸²æŸ“ã€‚å°½é‡é¿å…ä½¿ç”¨å¤§å›¾ç‰‡ï¼ˆä¼˜å…ˆä½¿ç”¨è£å‰ªè¿‡çš„ç‰ˆæœ¬æˆ–æ˜¯ç¼©ç•¥å›¾ï¼Œæ€»ä¹‹è¶Šå°è¶Šå¥½ï¼‰ã€‚å’Œè´Ÿè´£

è®¾è®¡çš„åŒäº‹åå•†ï¼Œåœ¨åˆ—è¡¨ä¸­å°½å¯èƒ½ç®€åŒ–ç‰¹æ•ˆå’Œäº¤äº’ï¼Œç²¾ç®€è¦å±•ç¤ºçš„ä¿¡æ¯ï¼ŒæŠŠé•¿å†…å®¹ç§»åˆ°è¯¦æƒ…é¡µä¸­ã€‚

### ä½¿ç”¨ shouldComponentUpdate

å¯¹æ‚¨çš„ç»„ä»¶å®æ–½æ›´æ–°éªŒè¯ã€‚ React çš„ `PureComponent` å®ç°äº†ä¸€ä¸ª [`shouldComponentUpdate`](https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate) ä¸æµ…æ¯”è¾ƒã€‚ è¿™åœ¨è¿™é‡Œå¾ˆæ˜‚è´µï¼Œå› ä¸ºå®ƒéœ€è¦æ£€æŸ¥æ‰€æœ‰é“å…·ã€‚ å¦‚æœæ‚¨æƒ³è¦è‰¯å¥½çš„ä½çº§æ€§èƒ½ï¼Œè¯·ä¸ºæ‚¨çš„åˆ—è¡¨é¡¹ç»„ä»¶åˆ›å»ºæœ€ä¸¥æ ¼çš„è§„åˆ™ï¼Œä»…æ£€æŸ¥å¯èƒ½ä¼šæ›´æ”¹çš„é“å…·ã€‚ å¦‚æœæ‚¨çš„åˆ—è¡¨è¶³å¤Ÿç®€å•ï¼Œæ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨

```javascript
shouldComponentUpdate() {
  return false
}
```

### ä½¿ç”¨ä¼˜åŒ–ç¼“å­˜çš„å›¾ç‰‡åº“

æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª [@DylanVann](https://github.com) çš„ç¤¾åŒºåŒ…ï¼ˆä¾‹å¦‚ [react-native-fast-image](https://github.com/DylanVann/react-native-fast-image) /DylanVann)) ä»¥è·å¾—æ›´é«˜æ€§èƒ½çš„å›¾åƒã€‚ åˆ—è¡¨ä¸­çš„æ¯å¼ å›¾ç‰‡éƒ½æ˜¯ä¸€ä¸ª `new Image()` å®ä¾‹ã€‚ å®ƒåˆ°è¾¾ `loaded` é’©å­çš„é€Ÿåº¦è¶Šå¿«ï¼Œä½ çš„ Javascript çº¿ç¨‹å°±ä¼šè¶Šå¿«å†æ¬¡ç©ºé—²ã€‚

### ä½¿ç”¨ getItemLayout

å¦‚æœä½ æ‰€æœ‰çš„åˆ—è¡¨é¡¹ç»„ä»¶éƒ½æœ‰ç›¸åŒçš„é«˜åº¦(æˆ–è€…å®½åº¦ï¼Œå¯¹äºæ°´å¹³åˆ—è¡¨æ¥è¯´)ï¼Œæä¾›[getItemLayout](https://reactnative.cn/docs/flatlist#getitemlayout) propå¯ä»¥æ¶ˆé™¤` FlatList`ç®¡ç†å¼‚æ­¥å¸ƒå±€è®¡ç®—çš„éœ€è¦ã€‚è¿™æ˜¯ä¸€ç§éå¸¸ç†æƒ³çš„ä¼˜åŒ–æŠ€æœ¯ã€‚

å¦‚æœæ‚¨çš„ç»„ä»¶å…·æœ‰åŠ¨æ€å¤§å°ï¼Œå¹¶ä¸”æ‚¨ç¡®å®éœ€è¦æ€§èƒ½ï¼Œè¯·è€ƒè™‘è¯¢é—®æ‚¨çš„è®¾è®¡å›¢é˜Ÿï¼Œä»–ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘é‡æ–°è®¾è®¡ä»¥æé«˜æ€§èƒ½ã€‚

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸ â­ï¸ â­ï¸

**æ³¨æ„ï¼š**

ä»¥ä¸‹å†…å®¹æ‘˜è‡ª[React Native FlatList åŸç†è§£æä¸æ€§èƒ½ä¼˜åŒ–](https://www.cnblogs.com/skychx/p/react-native-flatlist.html)

>- å¦‚æœ ListItem é«˜åº¦ä¸å›ºå®šï¼Œä½¿ç”¨ getItemLayout è¿”å›å›ºå®šé«˜åº¦æ—¶ï¼Œå› ä¸ºæœ€ç»ˆæ¸²æŸ“é«˜åº¦å’Œé¢„æµ‹é«˜åº¦ä¸ä¸€è‡´ï¼Œä¼šå‡ºç°é¡µé¢è·³åŠ¨çš„é—®é¢˜ã€[ğŸ”— é—®é¢˜é“¾æ¥](https://juejin.im/post/5b61479b6fb9a04f9963be77#heading-38)ã€‘
>- å¦‚æœä½¿ç”¨äº† `ItemSeparatorComponent`ï¼Œåˆ†éš”çº¿çš„å°ºå¯¸ä¹Ÿè¦è€ƒè™‘åˆ° offset çš„è®¡ç®—ä¸­ã€[ğŸ”— æ–‡æ¡£é“¾æ¥](https://reactnative.cn/docs/flatlist.html#getitemlayout)ã€‘
>- å¦‚æœ FlatList ä½¿ç”¨çš„æ—¶å€™ä½¿ç”¨äº† `ListHeaderComponent`ï¼Œä¹Ÿè¦æŠŠ Header çš„å°ºå¯¸è€ƒè™‘åˆ° offset çš„è®¡ç®—ä¸­ã€[ğŸ”— å®˜æ–¹ç¤ºä¾‹ä»£ç é“¾æ¥](https://github.com/facebook/react-native/blob/8553e1acc4195479190971cc7a3ffaa0ed37a5e0/RNTester/js/examples/MultiColumn/MultiColumnExample.js#L120)ã€‘


### ä½¿ç”¨ keyExtractor æˆ– key

ä½ å¯ä»¥è®¾ç½®[ keyExtractor'](https://reactnative.cn/docs/flatlist#keyextractor)ä¸ºä½ çš„`FlatList`ç»„ä»¶ã€‚è¯¥é“å…·ç”¨äºç¼“å­˜ï¼Œå¹¶ä½œä¸ºReactçš„â€œå…³é”®â€æ¥è·Ÿè¸ªç‰©å“çš„é‡æ–°æ’åºã€‚

ä½ ä¹Ÿå¯ä»¥åœ¨itemç»„ä»¶ä¸­ä½¿ç”¨ä¸€ä¸ªâ€œkeyâ€å±æ€§ã€‚

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸ â­ï¸ â­ï¸

### é¿å…åœ¨ renderItem ä¸­ä½¿ç”¨åŒ¿åå‡½æ•°

å°† `renderItem` å‡½æ•°ç§»å‡ºåˆ° render å‡½æ•°çš„å¤–éƒ¨ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨æ¯æ¬¡è°ƒç”¨ render å‡½æ•°æ—¶é‡æ–°åˆ›å»ºè‡ªå·±ã€‚

**æ¨èæŒ‡æ•°ï¼š** â­ï¸ â­ï¸ â­ï¸ â­ï¸


# å‚è€ƒ

- [åˆ—è¡¨é…ç½®ä¼˜åŒ–](https://www.react-native.cn/docs/optimizing-flatlist-configuration)
- [React Native FlatList åŸç†è§£æä¸æ€§èƒ½ä¼˜åŒ–](https://www.cnblogs.com/skychx/p/react-native-flatlist.html)
